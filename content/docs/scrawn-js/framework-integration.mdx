---
title: Framework Integration
description: Integration guides for popular JavaScript frameworks
---

## Overview

This guide provides detailed integration examples for popular JavaScript frameworks and runtimes.

<Callout type="info">
**Framework Compatibility Note**: Most examples use `sdkCallEventConsumer` directly in route handlers rather than the `middlewareEventConsumer` due to framework-specific middleware patterns. The `middlewareEventConsumer` is designed for Express-like frameworks with `(req, res, next)` signatures.
</Callout>

## Next.js

### App Router (Recommended)

```typescript title="app/api/generate/route.ts"
import { Scrawn } from '@scrawn/core';
import { NextRequest, NextResponse } from 'next/server';
import { auth } from '@/lib/auth';

const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY as `scrn_${string}`,
  baseURL: process.env.SCRAWN_BASE_URL || 'http://localhost:8069',
});

export async function POST(req: NextRequest) {
  const session = await auth();
  
  if (!session?.user?.id) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  // Start tracking (don't await yet)
  const trackingPromise = scrawn.sdkCallEventConsumer({
    userId: session.user.id,
    debitAmount: 100,
  });

  // Process request
  const result = await generateContent(await req.json());
  
  // Wait for tracking to complete
  await trackingPromise;
  
  return NextResponse.json(result);
}
```

### Middleware Integration

```typescript title="middleware.ts"
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';
import { Scrawn } from '@scrawn/core';
import { getToken } from 'next-auth/jwt';

const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY as `scrn_${string}`,
  baseURL: process.env.SCRAWN_BASE_URL || 'http://localhost:8069',
});

export async function middleware(request: NextRequest) {
  // Only track API routes
  if (!request.nextUrl.pathname.startsWith('/api')) {
    return NextResponse.next();
  }

  const token = await getToken({ req: request });
  
  if (token?.sub) {
    // Track in background, don't block request
    scrawn.sdkCallEventConsumer({
      userId: token.sub,
      debitAmount: 10,
    }).catch(err => console.error('Failed to track:', err));
  }

  return NextResponse.next();
}

export const config = {
  matcher: '/api/:path*',
};
```

## Express.js

```typescript title="server.ts"
import express from 'express';
import { Scrawn, type EventPayload } from '@scrawn/core';

const app = express();
app.use(express.json());

const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY as `scrn_${string}`,
  baseURL: process.env.SCRAWN_BASE_URL || 'http://localhost:8069',
});

// Use middleware to automatically track all API calls
app.use(scrawn.middlewareEventConsumer({
  extractor: (req): EventPayload | null => {
    if (!req.user) return null;
    
    return {
      userId: req.user.id,
      debitAmount: req.body?.cost || 10,
    };
  },
  blacklist: ['/health', '/api/collect-payment'],
}));

app.post('/api/generate', async (req, res) => {
  const result = await generateContent(req.body);
  res.json(result);
});

app.post('/api/collect-payment', async (req, res) => {
  const checkoutLink = await scrawn.collectPayment(req.body.userId);
  res.redirect(checkoutLink);
});

app.listen(3000);
```

## NestJS

```typescript title="scrawn.interceptor.ts"
import {
  Injectable,
  NestInterceptor,
  ExecutionContext,
  CallHandler,
} from '@nestjs/common';
import { Observable } from 'rxjs';
import { Scrawn } from '@scrawn/core';

@Injectable()
export class ScrawnInterceptor implements NestInterceptor {
  private scrawn: Scrawn;

  constructor() {
    this.scrawn = new Scrawn({
      apiKey: process.env.SCRAWN_KEY as `scrn_${string}`,
      baseURL: process.env.SCRAWN_BASE_URL || 'http://localhost:8069',
    });
  }

  async intercept(
    context: ExecutionContext,
    next: CallHandler,
  ): Promise<Observable<any>> {
    const request = context.switchToHttp().getRequest();
    const user = request.user;

    if (user) {
      // Track in background, don't block request
      this.scrawn.sdkCallEventConsumer({
        userId: user.id,
        debitAmount: 10,
      }).catch(err => {
        console.error('Failed to track event:', err);
      });
    }

    return next.handle();
  }
}
```

```typescript title="app.controller.ts"
import { Controller, Post, UseInterceptors } from '@nestjs/common';
import { ScrawnInterceptor } from './scrawn.interceptor';

@Controller('api')
@UseInterceptors(ScrawnInterceptor)
export class AppController {
  @Post('generate')
  async generate() {
    return { message: 'Content generated' };
  }
}
```

## tRPC

```typescript title="trpc/middleware.ts"
import { TRPCError } from '@trpc/server';
import { Scrawn } from '@scrawn/core';
import { t } from './trpc';

const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY as `scrn_${string}`,
  baseURL: process.env.SCRAWN_BASE_URL || 'http://localhost:8069',
});

export const trackUsage = t.middleware(async ({ ctx, next }) => {
  if (!ctx.session?.user?.id) {
    throw new TRPCError({ code: 'UNAUTHORIZED' });
  }

  // Start tracking (don't await)
  const trackingPromise = scrawn.sdkCallEventConsumer({
    userId: ctx.session.user.id,
    debitAmount: 10,
  });

  // Execute procedure
  const result = await next();
  
  // Wait for tracking
  await trackingPromise.catch(err => {
    console.error('Failed to track event:', err);
  });

  return result;
});

// Use in procedures
export const protectedProcedure = t.procedure.use(trackUsage);
```

## Remix

```typescript title="app/routes/api.generate.tsx"
import { json, type ActionFunctionArgs } from '@remix-run/node';
import { Scrawn } from '@scrawn/core';
import { requireUser } from '~/lib/auth.server';

const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY as `scrn_${string}`,
  baseURL: process.env.SCRAWN_BASE_URL || 'http://localhost:8069',
});

export async function action({ request }: ActionFunctionArgs) {
  const user = await requireUser(request);

  // Start tracking (don't await yet)
  const trackingPromise = scrawn.sdkCallEventConsumer({
    userId: user.id,
    debitAmount: 100,
  });

  // Process request
  const result = await generateContent(await request.json());
  
  // Wait for tracking
  await trackingPromise;
  
  return json(result);
}
```

## SvelteKit

```typescript title="src/routes/api/generate/+server.ts"
import { json, error } from '@sveltejs/kit';
import { Scrawn } from '@scrawn/core';
import type { RequestHandler } from './$types';

const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY as `scrn_${string}`,
  baseURL: process.env.SCRAWN_BASE_URL || 'http://localhost:8069',
});

export const POST: RequestHandler = async ({ request, locals }) => {
  const user = locals.user;
  
  if (!user) {
    throw error(401, 'Unauthorized');
  }

  // Start tracking (don't await yet)
  const trackingPromise = scrawn.sdkCallEventConsumer({
    userId: user.id,
    debitAmount: 100,
  });

  // Process request
  const result = await generateContent(await request.json());
  
  // Wait for tracking
  await trackingPromise;
  
  return json(result);
};
```

## Hono (Cloudflare Workers)

```typescript title="src/index.ts"
import { Hono } from 'hono';
import { Scrawn, type EventPayload } from '@scrawn/core';

const app = new Hono();

const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY as `scrn_${string}`,
  baseURL: process.env.SCRAWN_BASE_URL || 'http://localhost:8069',
});

// Use Scrawn middleware
app.use('/api/*', async (c, next) => {
  const middleware = scrawn.middlewareEventConsumer({
    extractor: (req): EventPayload | null => {
      const user = (req as any).user;
      if (!user) return null;
      
      return {
        userId: user.id,
        debitAmount: 10,
      };
    },
  });
  
  await new Promise<void>((resolve) => {
    middleware(c.req.raw as any, {} as any, () => resolve());
  });
  
  await next();
});

app.post('/api/generate', async (c) => {
  const result = await generateContent(await c.req.json());
  return c.json(result);
});

export default app;
```
