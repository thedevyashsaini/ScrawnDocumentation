---
title: SDK Guide
description: Complete guide to using the Scrawn SDK in your application
---

## Installation

```npm
npm install @scrawn/sdk
```

## Initialization

### Basic Setup

```typescript
import { Scrawn } from '@scrawn/sdk';

const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY!,
  baseUrl: process.env.SCRAWN_BASE_URL!
});
```

### Configuration Options

```typescript
const scrawn = new Scrawn({
  apiKey: string;           // Your API key (required)
  baseUrl: string;          // Backend URL (required)
  timeout?: number;         // Request timeout in ms (default: 30000)
  retries?: number;         // Retry attempts (default: 3)
  enableLogging?: boolean;  // Enable SDK logs (default: false)
});
```

## Core Methods

### Track SDK Calls

Track billable events in your application:

```typescript
await scrawn.sdkCallEventConsumer({
  userId: string;              // Unique user identifier
  eventType: string;           // Event category
  metadata?: Record<string, any>;  // Additional data
  timestamp?: number;          // Unix timestamp (optional)
});
```

**Example:**

```typescript
await scrawn.sdkCallEventConsumer({
  userId: 'user_123',
  eventType: 'api_call',
  metadata: {
    endpoint: '/api/generate',
    method: 'POST',
    tokens: 1500
  }
});
```

### Track Middleware Events

Similar to `sdkCallEventConsumer` but for middleware-tracked events:

```typescript
await scrawn.middlewareEventConsumer({
  userId: string;
  eventType: string;
  metadata?: Record<string, any>;
  timestamp?: number;
});
```

**Example:**

```typescript
// In Express middleware
app.use(async (req, res, next) => {
  await scrawn.middlewareEventConsumer({
    userId: req.user.id,
    eventType: 'page_view',
    metadata: {
      path: req.path,
      userAgent: req.headers['user-agent']
    }
  });
  next();
});
```

### Collect Payment

Generate payment links when usage exceeds threshold:

```typescript
const checkoutUrl = await scrawn.collectPayment({
  userId: string;              // User to charge
  amount: number;              // Amount in cents
  currency?: string;           // Currency code (default: 'USD')
  description?: string;        // Payment description
  metadata?: Record<string, any>;  // Additional data
});
```

**Example:**

```typescript
const url = await scrawn.collectPayment({
  userId: 'user_123',
  amount: 2999, // $29.99
  currency: 'USD',
  description: 'API usage for December 2024',
  metadata: {
    plan: 'pro',
    billingCycle: 'monthly'
  }
});

console.log('Payment link:', url);
// Send link to user via email/notification
```

## Event Types

Define custom event types based on your billing model:

### API-Based Billing

```typescript
// Track API calls
await scrawn.sdkCallEventConsumer({
  userId: 'user_123',
  eventType: 'api_call',
  metadata: { endpoint: '/api/users', method: 'GET' }
});
```

### Compute-Based Billing

```typescript
// Track compute usage
await scrawn.sdkCallEventConsumer({
  userId: 'user_123',
  eventType: 'compute',
  metadata: { 
    duration: 5.2, // seconds
    memory: 512,   // MB
    cpu: 2         // cores
  }
});
```

### Storage-Based Billing

```typescript
// Track storage usage
await scrawn.sdkCallEventConsumer({
  userId: 'user_123',
  eventType: 'storage',
  metadata: { 
    bytes: 1024000000, // ~1GB
    operation: 'upload'
  }
});
```

### AI/LLM Usage

```typescript
// Track AI model usage
await scrawn.sdkCallEventConsumer({
  userId: 'user_123',
  eventType: 'ai_generation',
  metadata: { 
    model: 'gpt-4',
    inputTokens: 500,
    outputTokens: 1500,
    totalTokens: 2000
  }
});
```

## Framework Integrations

### Express.js

```typescript
import express from 'express';
import { Scrawn } from '@scrawn/sdk';

const app = express();
const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY!,
  baseUrl: process.env.SCRAWN_BASE_URL!
});

// Middleware to track all API calls
app.use(async (req, res, next) => {
  if (req.user) {
    await scrawn.middlewareEventConsumer({
      userId: req.user.id,
      eventType: 'api_call',
      metadata: {
        endpoint: req.path,
        method: req.method
      }
    });
  }
  next();
});

// Track specific endpoint
app.post('/api/generate', async (req, res) => {
  await scrawn.sdkCallEventConsumer({
    userId: req.user.id,
    eventType: 'ai_generation',
    metadata: { prompt: req.body.prompt }
  });
  
  // Your logic here
  res.json({ result: 'generated content' });
});

app.listen(3000);
```

### Next.js

#### App Router (Server Actions)

```typescript
// app/actions/track-event.ts
'use server';

import { Scrawn } from '@scrawn/sdk';

const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY!,
  baseUrl: process.env.SCRAWN_BASE_URL!
});

export async function trackEvent(userId: string, eventType: string) {
  await scrawn.sdkCallEventConsumer({
    userId,
    eventType,
    metadata: { timestamp: Date.now() }
  });
}
```

```typescript
// app/api/generate/route.ts
import { Scrawn } from '@scrawn/sdk';

const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY!,
  baseUrl: process.env.SCRAWN_BASE_URL!
});

export async function POST(req: Request) {
  const { userId, prompt } = await req.json();
  
  await scrawn.sdkCallEventConsumer({
    userId,
    eventType: 'ai_generation',
    metadata: { prompt }
  });
  
  return Response.json({ success: true });
}
```

#### Pages Router (API Routes)

```typescript
// pages/api/track.ts
import type { NextApiRequest, NextApiResponse } from 'next';
import { Scrawn } from '@scrawn/sdk';

const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY!,
  baseUrl: process.env.SCRAWN_BASE_URL!
});

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  await scrawn.sdkCallEventConsumer({
    userId: req.body.userId,
    eventType: req.body.eventType,
    metadata: req.body.metadata
  });
  
  res.status(200).json({ success: true });
}
```

### Fastify

```typescript
import Fastify from 'fastify';
import { Scrawn } from '@scrawn/sdk';

const fastify = Fastify();
const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY!,
  baseUrl: process.env.SCRAWN_BASE_URL!
});

// Plugin for automatic tracking
fastify.addHook('onRequest', async (request, reply) => {
  if (request.user) {
    await scrawn.middlewareEventConsumer({
      userId: request.user.id,
      eventType: 'api_call',
      metadata: {
        endpoint: request.url,
        method: request.method
      }
    });
  }
});

// Specific route tracking
fastify.post('/api/process', async (request, reply) => {
  await scrawn.sdkCallEventConsumer({
    userId: request.user.id,
    eventType: 'data_processing',
    metadata: { size: request.body.length }
  });
  
  return { success: true };
});

fastify.listen({ port: 3000 });
```

### tRPC

```typescript
import { initTRPC } from '@trpc/server';
import { Scrawn } from '@scrawn/sdk';

const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY!,
  baseUrl: process.env.SCRAWN_BASE_URL!
});

const t = initTRPC.create();

export const appRouter = t.router({
  generate: t.procedure
    .input(z.object({ prompt: z.string() }))
    .mutation(async ({ ctx, input }) => {
      // Track event
      await scrawn.sdkCallEventConsumer({
        userId: ctx.user.id,
        eventType: 'ai_generation',
        metadata: { prompt: input.prompt }
      });
      
      // Your logic
      return { result: 'generated content' };
    }),
});
```

### NestJS

```typescript
// scrawn.service.ts
import { Injectable } from '@nestjs/common';
import { Scrawn } from '@scrawn/sdk';

@Injectable()
export class ScrawnService {
  private scrawn: Scrawn;

  constructor() {
    this.scrawn = new Scrawn({
      apiKey: process.env.SCRAWN_KEY!,
      baseUrl: process.env.SCRAWN_BASE_URL!
    });
  }

  async trackEvent(userId: string, eventType: string, metadata?: any) {
    return this.scrawn.sdkCallEventConsumer({
      userId,
      eventType,
      metadata
    });
  }

  async collectPayment(userId: string, amount: number) {
    return this.scrawn.collectPayment({
      userId,
      amount,
      currency: 'USD'
    });
  }
}
```

```typescript
// app.controller.ts
import { Controller, Post, Body } from '@nestjs/common';
import { ScrawnService } from './scrawn.service';

@Controller('api')
export class AppController {
  constructor(private scrawnService: ScrawnService) {}

  @Post('generate')
  async generate(@Body() body: { userId: string; prompt: string }) {
    await this.scrawnService.trackEvent(
      body.userId,
      'ai_generation',
      { prompt: body.prompt }
    );
    
    return { success: true };
  }
}
```

## Error Handling

```typescript
import { Scrawn, ScrawnError } from '@scrawn/sdk';

const scrawn = new Scrawn({
  apiKey: process.env.SCRAWN_KEY!,
  baseUrl: process.env.SCRAWN_BASE_URL!
});

try {
  await scrawn.sdkCallEventConsumer({
    userId: 'user_123',
    eventType: 'api_call'
  });
} catch (error) {
  if (error instanceof ScrawnError) {
    console.error('Scrawn error:', error.code, error.message);
    
    // Handle specific errors
    switch (error.code) {
      case 'UNAUTHORIZED':
        // Invalid API key
        break;
      case 'RATE_LIMITED':
        // Too many requests
        break;
      case 'NETWORK_ERROR':
        // Connection failed
        break;
      default:
        // Other errors
    }
  }
}
```

## Best Practices

<Callout type="warn" title="Security First">
Always store API keys in environment variables, never hardcode them in your source code.
</Callout>

### Environment Variables

```bash
# .env
SCRAWN_KEY=scrawn_sk_your_key_here
SCRAWN_BASE_URL=https://api.scrawn.yourdomain.com
```

### Singleton Instance

```typescript
// lib/scrawn.ts
import { Scrawn } from '@scrawn/sdk';

let scrawnInstance: Scrawn | null = null;

export function getScrawn(): Scrawn {
  if (!scrawnInstance) {
    scrawnInstance = new Scrawn({
      apiKey: process.env.SCRAWN_KEY!,
      baseUrl: process.env.SCRAWN_BASE_URL!
    });
  }
  return scrawnInstance;
}
```

```typescript
// Usage
import { getScrawn } from '@/lib/scrawn';

const scrawn = getScrawn();
await scrawn.sdkCallEventConsumer({ ... });
```

### Async Tracking (Non-Blocking)

```typescript
// Fire and forget - don't block response
scrawn.sdkCallEventConsumer({
  userId: 'user_123',
  eventType: 'api_call'
}).catch(err => console.error('Failed to track event:', err));

// Return response immediately
res.json({ success: true });
```

### Batch Events

```typescript
// Collect events
const events = [];

events.push({ userId: 'user_1', eventType: 'api_call' });
events.push({ userId: 'user_2', eventType: 'api_call' });

// Track in parallel
await Promise.all(
  events.map(event => scrawn.sdkCallEventConsumer(event))
);
```

## TypeScript Types

```typescript
interface ScrawnConfig {
  apiKey: string;
  baseUrl: string;
  timeout?: number;
  retries?: number;
  enableLogging?: boolean;
}

interface EventPayload {
  userId: string;
  eventType: string;
  metadata?: Record<string, any>;
  timestamp?: number;
}

interface PaymentPayload {
  userId: string;
  amount: number;
  currency?: string;
  description?: string;
  metadata?: Record<string, any>;
}
```

## Next Steps

<Cards>
  <Card href="/docs/api-reference" title="API Reference">
    Full API documentation
  </Card>
  <Card href="/docs/examples" title="Examples">
    More integration examples
  </Card>
  <Card href="/docs/advanced" title="Advanced">
    Advanced features and customization
  </Card>
</Cards>
